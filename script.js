const fragen50 = [
    {
        frage: "Wer anderen eine Grube gräbt...",
        antworten: [
            { text: "Bekommt ein Bauzertifikat", korrekt: false },
            { text: "Hat einen Bagger", korrekt: false },
            { text: "Muss sie auch betonieren", korrekt: false },
            { text: "Fällt selbst hinein", korrekt: true }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Kontinente gibt es?",
        antworten: [
            { text: "5", korrekt: false },
            { text: "7", korrekt: true },
            { text: "4", korrekt: false },
            { text: "6", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was ist der höchste Berg in Deutschland?",
        antworten: [
            { text: "Zugspitze", korrekt: true },
            { text: "Watzmann", korrekt: false },
            { text: "Mount Everest", korrekt: false },
            { text: "Brocken", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welche Farben hat die Flagge von Griechenland?",
        antworten: [
            { text: "Grau und Blau", korrekt: false },
            { text: "Schwarz und Weiß", korrekt: false },
            { text: "Blau und Weiß", korrekt: true },
            { text: "Rot und Weiß", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welches dieser Länder grenzt NICHT an Deutschland?",
        antworten: [
            { text: "Italien", korrekt: true },
            { text: "Dänemark", korrekt: false },
            { text: "Schweiz", korrekt: false },
            { text: "Luxemburg", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Tage hat ein Schaltjahr?",
        antworten: [
            { text: "364", korrekt: false },
            { text: "365", korrekt: false },
            { text: "366", korrekt: true },
            { text: "367", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welche Farbe entsteht aus Blau und Gelb?",
        antworten: [
            { text: "Grün", korrekt: true },
            { text: "Lila", korrekt: false },
            { text: "Orange", korrekt: false },
            { text: "Braun", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Beine hat eine Spinne?",
        antworten: [
            { text: "6", korrekt: false },
            { text: "8", korrekt: true },
            { text: "10", korrekt: false },
            { text: "4", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher Monat hat nur 28 oder 29 Tage?",
        antworten: [
            { text: "Februar", korrekt: true },
            { text: "März", korrekt: false },
            { text: "Juni", korrekt: false },
            { text: "November", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was ist das Gegenteil von 'hell'?",
        antworten: [
            { text: "dunkel", korrekt: true },
            { text: "langsam", korrekt: false },
            { text: "kalt", korrekt: false },
            { text: "schnell", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welches Tier sagt 'Miau'?",
        antworten: [
            { text: "Hund", korrekt: false },
            { text: "Katze", korrekt: true },
            { text: "Kuh", korrekt: false },
            { text: "Vogel", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "In welchem Spiel baust du mit Klötzen?",
        antworten: [
            { text: "Minecraft", korrekt: true },
            { text: "Roblox", korrekt: false },
            { text: "Fortnite", korrekt: false },
            { text: "Among Us", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt das Pilzkönigreich in Super Mario?",
        antworten: [
            { text: "Mushroom Kingdom", korrekt: true },
            { text: "Koopa-Land", korrekt: false },
            { text: "Luigi-Land", korrekt: false },
            { text: "Goomba-Welt", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "In welchem Spiel jagt man Geister mit einem Staubsauger?",
        antworten: [
            { text: "Luigi's Mansion", korrekt: true },
            { text: "Pokemon", korrekt: false },
            { text: "Animal Crossing", korrekt: false },
            { text: "Zelda", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher blaue Igel ist Maskottchen von Sega?",
        antworten: [
            { text: "Sonic", korrekt: true },
            { text: "Shadow", korrekt: false },
            { text: "Tails", korrekt: false },
            { text: "Knuckles", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
];

const fragen1000 = [
    {
        frage: "Was ist die aktuelle Fortnite Season?",
        antworten: [
            { text: "Kapitel 5 - Season 9", korrekt: false },
            { text: "Kapitel 6 - Season 7", korrekt: false },
            { text: "Kapitel 6 – Season 2", korrekt: true },
            { text: "Kapitel 6 - Season 4", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was ist der Superlativ von gut?",
        antworten: [
            { text: "güter", korrekt: false },
            { text: "am besten", korrekt: true },
            { text: "schlecht", korrekt: false },
            { text: "besser", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was hat die Ordnungszahl 1 im Periodensystem?",
        antworten: [
            { text: "Kohlenstoff", korrekt: false },
            { text: "Wasserstoff", korrekt: true },
            { text: "Sauerstoff", korrekt: false },
            { text: "Helium", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was versteht man unter Demokratie?",
        antworten: [
            { text: "Eine Regierungsform, in der nur Könige regieren", korrekt: false },
            { text: "Eine Regierungsform, in der eine Person alle Entscheidungen trifft", korrekt: false },
            { text: "Eine Regierungsform, bei der die Regierung keine Macht hat", korrekt: false },
            { text: "Eine Regierungsform, bei der das Volk mitbestimmen kann", korrekt: true }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher Planet ist der Erde am nächsten?",
        antworten: [
            { text: "Jupiter", korrekt: false },
            { text: "Merkur", korrekt: true },
            { text: "Venus", korrekt: false },
            { text: "Mars", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt der längste Fluss der Welt?",
        antworten: [
            { text: "Nil", korrekt: true },
            { text: "Amazonas", korrekt: false },
            { text: "Mississippi", korrekt: false },
            { text: "Jangtse", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Nullen hat eine Billion?",
        antworten: [
            { text: "6", korrekt: false },
            { text: "9", korrekt: false },
            { text: "12", korrekt: true },
            { text: "15", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt das Element mit dem Symbol O?",
        antworten: [
            { text: "Gold", korrekt: false },
            { text: "Sauerstoff", korrekt: true },
            { text: "Silber", korrekt: false },
            { text: "Zink", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher Planet hat Ringe?",
        antworten: [
            { text: "Mars", korrekt: false },
            { text: "Jupiter", korrekt: false },
            { text: "Saturn", korrekt: true },
            { text: "Erde", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Bundesländer hat Deutschland?",
        antworten: [
            { text: "14", korrekt: false },
            { text: "16", korrekt: true },
            { text: "18", korrekt: false },
            { text: "12", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wer schrieb 'Harry Potter'?",
        antworten: [
            { text: "J.K. Rowling", korrekt: true },
            { text: "Stephen King", korrekt: false },
            { text: "Suzanne Collins", korrekt: false },
            { text: "Rick Riordan", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was ergibt 9 × 8?",
        antworten: [
            { text: "72", korrekt: true },
            { text: "64", korrekt: false },
            { text: "81", korrekt: false },
            { text: "69", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welches Spiel popularisierte den Battle Royale Modus?",
        antworten: [
            { text: "PlayerUnknown's Battlegrounds", korrekt: true },
            { text: "Fortnite", korrekt: false },
            { text: "Apex Legends", korrekt: false },
            { text: "Call of Duty: Warzone", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt das meistverkaufte Videospiel aller Zeiten?",
        antworten: [
            { text: "Minecraft", korrekt: true },
            { text: "Tetris", korrekt: false },
            { text: "GTA V", korrekt: false },
            { text: "Wii Sports", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
];

const fragen32000 = [
    {
        frage: "Was sieht man NICHT in Tryus Cam wenn er Streamt",
        antworten: [
            { text: "Microphone", korrekt: false },
            { text: "Fernseher", korrekt: false },
            { text: "Bett", korrekt: false },
            { text: "18 Schild", korrekt: true }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wer war der erste Bundeskanzler von Deutschland?",
        antworten: [
            { text: "Frank-Walter Steinmeier", korrekt: false },
            { text: "Konrad Adenauer", korrekt: true },
            { text: "Willy Brandt", korrekt: false },
            { text: "Adolf Hitler", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "In welchem Jahr fiel die Berliner Mauer?",
        antworten: [
            { text: "1987", korrekt: false },
            { text: "1989", korrekt: true },
            { text: "1991", korrekt: false },
            { text: "1993", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Löse nach x auf: 2(x−4)=10",
        antworten: [
            { text: "12", korrekt: false },
            { text: "16", korrekt: false },
            { text: "9", korrekt: true },
            { text: "3", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie lautet die chemische Formel von Kochsalz?",
        antworten: [
            { text: "NaCl", korrekt: true },
            { text: "H2O", korrekt: false },
            { text: "CO2", korrekt: false },
            { text: "C6H12O6", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welches dieser Länder gehört NICHT zur EU?",
        antworten: [
            { text: "Schweden", korrekt: false },
            { text: "Norwegen", korrekt: true },
            { text: "Spanien", korrekt: false },
            { text: "Italien", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Planeten hat unser Sonnensystem (Stand 2025)?",
        antworten: [
            { text: "8", korrekt: true },
            { text: "9", korrekt: false },
            { text: "10", korrekt: false },
            { text: "7", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welches Land hat die zweitgrößte Bevölkerung der Welt (2025)?",
        antworten: [
            { text: "USA", korrekt: false },
            { text: "China", korrekt: false },
            { text: "Indien", korrekt: true },
            { text: "Indonesien", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was ist das Quadrat von 15?",
        antworten: [
            { text: "215", korrekt: false },
            { text: "200", korrekt: false },
            { text: "225", korrekt: true },
            { text: "235", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie lautet der Hauptsatz der Thermodynamik?",
        antworten: [
            { text: "Energie kann weder erzeugt noch vernichtet werden", korrekt: true },
            { text: "Materie ist konstant", korrekt: false },
            { text: "Jede Reaktion ist exotherm", korrekt: false },
            { text: "Wärme fließt immer nach oben", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher Künstler malte die 'Sternennacht'?",
        antworten: [
            { text: "Van Gogh", korrekt: true },
            { text: "Monet", korrekt: false },
            { text: "Picasso", korrekt: false },
            { text: "Da Vinci", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
];

const fragen1mio = [
    {
        frage: "Welche Stadt ist die Hauptstadt von Australien?",
        antworten: [
            { text: "Brisbane", korrekt: false },
            { text: "Sydney", korrekt: false },
            { text: "Melbourne", korrekt: false },
            { text: "Canberra", korrekt: true }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie viele Chromosomen hat ein Mensch?",
        antworten: [
            { text: "44", korrekt: false },
            { text: "46", korrekt: true },
            { text: "48", korrekt: false },
            { text: "50", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt der längste Nerv im menschlichen Körper?",
        antworten: [
            { text: "Vagusnerv", korrekt: false },
            { text: "Ischiasnerv", korrekt: true },
            { text: "Sehnerv", korrekt: false },
            { text: "Medianus", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Wie heißt die Hauptstadt von Kanada?",
        antworten: [
            { text: "Toronto", korrekt: false },
            { text: "Ottawa", korrekt: true },
            { text: "Montreal", korrekt: false },
            { text: "Vancouver", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Was bedeutet das lateinische Wort 'Aqua'?",
        antworten: [
            { text: "Wasser", korrekt: true },
            { text: "Feuer", korrekt: false },
            { text: "Licht", korrekt: false },
            { text: "Luft", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher Computerpionier entwickelte das Konzept des Personal Computers (PC)?",
        antworten: [
            { text: "Steve Wozniak", korrekt: true },
            { text: "Steve Jobs", korrekt: false },
            { text: "Bill Gates", korrekt: false },
            { text: "Linus Torvalds", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    },
    {
        frage: "Welcher dieser Begriffe ist KEIN Bestandteil der DNA?",
        antworten: [
            { text: "Adenin", korrekt: false },
            { text: "Thymin", korrekt: false },
            { text: "Zink", korrekt: true },
            { text: "Cytosin", korrekt: false }
        ],
        bild: null,
        selectedAntwort: null
    }
];

let fragen = [
    ...shuffleArray(shuffleArray(fragen50)).slice(0, 5),
    ...shuffleArray(shuffleArray(fragen1000)).slice(0, 5),
    ...shuffleArray(shuffleArray(fragen32000)).slice(0, 4),
    ...shuffleArray(shuffleArray(fragen1mio)).slice(0, 1)
];


const gewinn = [
    "50 Euro",
    "100 Euro",
    "200 Euro",
    "300 Euro",
    "500 Euro",
    "1.000 Euro",
    "2.000 Euro",
    "4.000 Euro",
    "8.000 Euro",
    "16.000 Euro",
    "32.000 Euro",
    "64.000 Euro",
    "125.000 Euro",
    "500.000 Euro",
    "1 MILLION Euro",
]

let aktuelleFrageIndex = -1;
let verwendeter50_50_Joker = false;
let verwendeterPublikumsjoker = false;
let verwendeterDiscordJoker = false;

//shuffle the answers
fragen.forEach(frage => {
    frage.antworten = shuffleArray(frage.antworten);
});

function shuffleArray(array) {
    for (let i = 0; i < array.length - 1; i++) {
        // wähle j zufällig im Bereich [i..array.length-1]
        const j = i + Math.floor(Math.random() * (array.length - i));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

const start = new Audio("start.mp3");
const neueFrage = new Audio("neueFrage.mp3");
const fragenSound = new Audio("frage.mp3");
const richtig = new Audio("richtig.mp3");
const falsch = new Audio("falsch.mp3");
const final = new Audio("final.mp3");
const board = new Audio("board.mp3");
window.addEventListener("click", function () {
    if (aktuelleFrageIndex === -1) {
        start.play();
    }
});

document.getElementById("logo").addEventListener("click", function (event) {
    if (aktuelleFrageIndex === -1) {
        aktuelleFrageIndex = 0;
        zeigeFrage(aktuelleFrageIndex);
        document.getElementById("logo").classList.add("logo-off");
        start.pause();
    }
})

function zeigeFrage(index) {
    document.getElementById("chat").style.display = "none";
    document.getElementById("particles-js").classList.remove("show");
    neueFrage.play();
    fragenSound.play();
    const frageContainer = document.getElementById("frage-container");
    frageContainer.innerHTML = "";

    const infosContainer = document.createElement("div");
    infosContainer.classList.add("infos-container");

    // Joker-Buttons hinzufügen
    const jokerContainer = document.createElement("div");
    jokerContainer.classList.add("joker-container");

    const jokerButton1 = document.createElement("button");
    jokerButton1.textContent = "50:50";
    jokerButton1.classList.add("joker-button");
    jokerButton1.addEventListener("click", () => {
        // Logik für 50:50-Joker
        const aktuelleFrage = fragen[aktuelleFrageIndex];
        const falscheAntworten = aktuelleFrage.antworten
            .map((antwort, index) => ({ ...antwort, index }))
            .filter(antwort => !antwort.korrekt);

        // Wähle zufällig zwei falsche Antworten aus
        const zuEntfernendeAntworten = shuffleArray(falscheAntworten).slice(0, 2);

        // Entferne die Antworten visuell und deaktiviere sie
        const antwortButtons = document.querySelectorAll(".antwort-button");
        zuEntfernendeAntworten.forEach(antwort => {
            const button = antwortButtons[antwort.index];
            button.classList.add("ausgeblendet");
            button.disabled = true;
        });

        // Deaktiviere den Joker-Button
        jokerButton1.disabled = true;
        jokerButton1.classList.add("deaktiviert");

        verwendeter50_50_Joker = true;
    });
    if (!verwendeter50_50_Joker) {
        jokerContainer.appendChild(jokerButton1);
    }

    const jokerButton2 = document.createElement("button");
    jokerButton2.textContent = "Chat-Joker";
    jokerButton2.classList.add("joker-button");
    jokerButton2.addEventListener("click", () => {
        document.getElementById("chat").style.display = "block";
        verwendeterPublikumsjoker = true;

        jokerButton2.disabled = true;
        jokerButton2.classList.add("deaktiviert");
    });
    if (!verwendeterPublikumsjoker) {
        jokerContainer.appendChild(jokerButton2);
    }

    const jokerButton3 = document.createElement("button");
    jokerButton3.textContent = "Discord-Joker";
    jokerButton3.classList.add("joker-button");
    jokerButton3.addEventListener("click", () => {
        verwendeterDiscordJoker = true;

        jokerButton3.disabled = true;
        jokerButton3.classList.add("deaktiviert");
    } );
    if (!verwendeterDiscordJoker) {
        jokerContainer.appendChild(jokerButton3);
    }

    infosContainer.appendChild(jokerContainer);

    // Textfeld für aktuelles Geld hinzufügen
    const geldContainer = document.createElement("div");
    geldContainer.classList.add("geld-container");
    geldContainer.textContent = gewinn[aktuelleFrageIndex] || "€ 0";
    infosContainer.appendChild(geldContainer);

    frageContainer.appendChild(infosContainer);

    const frage = document.createElement("h2");
    frage.textContent = fragen[index].frage;
    frageContainer.appendChild(frage);

    if (fragen[index].bild !== null) {
        const bild = document.createElement("img");
        bild.src = fragen[index].bild;
        bild.alt = "Bild zur Frage";
        bild.classList.add("frage-bild");
        frageContainer.appendChild(bild);
    }

    const antwortenContainer = document.createElement("div");
    antwortenContainer.classList.add("antworten-container");
    fragen[index].antworten.forEach((antwort, i) => {
        const antwortButton = document.createElement("button");
        antwortButton.innerHTML = "<span class='buchstabe'>" + String.fromCharCode(65 + i) + ":</span> " + antwort.text;
        antwortButton.classList.add("antwort-button");
        antwortButton.addEventListener("click", () => {
            wähleAntwort(index, i);
        });
        antwortenContainer.appendChild(antwortButton);
    });
    frageContainer.appendChild(antwortenContainer);
}

function wähleAntwort(frageIndex, antwortIndex) {
    fragenSound.pause();
    const frage = fragen[frageIndex];
    frage.selectedAntwort = antwortIndex;

    const antwortButtons = document.querySelectorAll(".antwort-button");
    antwortButtons.forEach((button, index) => {
        button.disabled = true;
        if (index === antwortIndex) {
            button.classList.add("selected");
        }
        if (frage.antworten[index].korrekt) {
            button.classList.add("korrekt");
        } else {
            if (!frage.antworten[antwortIndex].korrekt) {
                button.classList.add("falsch");
            }
        }
    });


    if (frage.antworten[antwortIndex].korrekt) {
        richtig.play();
        document.getElementById("particles-js").classList.add("show");

        setTimeout(() => {
            aktuelleFrageIndex++;
            if (aktuelleFrageIndex < fragen.length) {
                zeigeGewinnÜbersicht(() => zeigeFrage(aktuelleFrageIndex));
            } else {
                zeigeGewinn();
            }
        }, 6000); // Nur 1 Sekunde Verzögerung bis zur Übersicht
    } else {
        falsch.play();
        setTimeout(() => {
            zeigeVerloren();
        }, 1000);
    }
}

function zeigeGewinnÜbersicht(callback) {
    board.play();
    document.getElementById("chat").style.display = "none";
    const frageContainer = document.getElementById("frage-container");
    frageContainer.innerHTML = "";

    const logo = document.getElementById("logo");
    logo.style.top = "-25vmin";

    const gewinnContainer = document.getElementById("gewinn-uebersicht");
    gewinnContainer.innerHTML = "";
    gewinnContainer.classList.add("uebersicht-aktiv");

    const weiterButton = document.createElement("button");
    weiterButton.textContent = "Nächste Frage";
    weiterButton.classList.add("cheat-button");
    weiterButton.addEventListener("click", () => {
        board.pause();
        gewinnContainer.classList.remove("uebersicht-aktiv");
        logo.style.top = "25%";
        setTimeout(() => {
            callback();
        }, 500);
    });
    gewinnContainer.appendChild(weiterButton);

    gewinn.forEach((betrag, index) => {
        const eintrag = document.createElement("div");
        eintrag.textContent = betrag;
        eintrag.classList.add("gewinn-eintrag");
        if (index === aktuelleFrageIndex) {
            eintrag.classList.add("aktuell");
        }
        gewinnContainer.appendChild(eintrag);
    });

    const logoimg = document.createElement("img");
    logoimg.src = "img.png";
    logoimg.alt = "Logo";
    logoimg.style.width = "150px";
    logoimg.style.height = "150px";
    logoimg.style.margin = "10px auto";
    gewinnContainer.appendChild(logoimg);
}


function zeigeGewinn() {
    richtig.pause();
    final.play();

    const frageContainer = document.getElementById("frage-container");
    frageContainer.innerHTML = "";

    const gewinnContainer = document.getElementById("gewinn-container");
    gewinnContainer.innerHTML = "";
    gewinnContainer.style.display = "block";

    const gewinnText = document.createElement("h2");
    gewinnText.textContent = "Herzlichen Glückwunsch! Du hast gewonnen: 1 MILLION Euro!";
    gewinnContainer.appendChild(gewinnText);
}

function zeigeVerloren() {
    const verlorenContainer = document.getElementById("verloren-container");
    verlorenContainer.innerHTML = "";
    verlorenContainer.style.display = "block";

    const verlorenText = document.createElement("h2");
    verlorenText.textContent = "Leider verloren!";
    verlorenContainer.appendChild(verlorenText);

    //cheaten button um die nächste Frage zu sehen
    const cheatButton = document.createElement("button");
    cheatButton.textContent = "> Ich bin ein Cheater! <";
    cheatButton.classList.add("cheat-button");

    cheatButton.addEventListener("click", () => {
        aktuelleFrageIndex++;
        if (aktuelleFrageIndex < fragen.length) {
            zeigeGewinnÜbersicht(() => zeigeFrage(aktuelleFrageIndex));
        } else {
            zeigeGewinn();
        }
        verlorenContainer.style.display = "none";
    });

    verlorenContainer.appendChild(cheatButton);
}


let twitch = new WebSocket("wss://irc-ws.chat.twitch.tv:443");

function setupTwitchWebSocket() {
    twitch.onopen = () => {
        console.log("Verbunden mit Twitch IRC");

        twitch.send("PASS SCHMOOPIIE");
        twitch.send("NICK justinfan12345");
        twitch.send("CAP REQ :twitch.tv/tags twitch.tv/commands");
        twitch.send("JOIN #tryus");

        const chatList = document.getElementById("chat");
        const chat = document.createElement('div');
        chat.innerHTML = `Verbunden mit Twitch IRC`;
        chatList.appendChild(chat);

        setTimeout(() => {
            chat.classList.add('hidden');
            setTimeout(() => {
                chatList.removeChild(chat);
            }, 500);
        }, 3000);
    };
}

setupTwitchWebSocket();

twitch.onmessage = (event) => {
    const messages = event.data.split("\r\n");

    messages.forEach((message) => {
        if (message.includes("PRIVMSG")) {

            const tagPart = message.split(" ")[0];
            const userPart = message.split("!")[0].substring(1);
            const msgPart = message.split(`PRIVMSG #tryus :`)[1];

            if (!msgPart) return;

            const tags = parseTags(tagPart);
            const displayName = tags["display-name"] || userPart;
            const color = tags["color"] || "#ffffff";
            const roles = getUserRoles(tags["badges"]);

            const notShowingUsers = ["streamelements", "nightbot", "moobot", "streamlabs"];
            if (notShowingUsers.includes(displayName.toLowerCase())) return;

            const userBadge = badge[roles] || "";

            const chatList = document.getElementById("chat");

            const chat = document.createElement('div');
            chat.innerHTML = `${userBadge} <span style="color:${color}" class="${roles}">${displayName}</span>: ${msgPart}`;
            chatList.appendChild(chat);

            chat.scrollIntoView({ behavior: "smooth" });

            setTimeout(() => {
                chat.classList.add('hidden');
                setTimeout(() => {
                    chatList.removeChild(chat);
                }, 500);
            }, 60000);
        }

        if (message.startsWith("PING")) {
            twitch.send("PONG :tmi.twitch.tv");
        }
    });
};

const badge = {
    broadcaster: "👑",
    mod: "🛡️",
    vip: "🌟",
    subscriber: "💎"
};

function parseTags(tagString) {
    const tags = {};
    tagString.substring(1).split(";").forEach(tag => {
        const [key, value] = tag.split("=");
        tags[key] = value || "";
    });
    return tags;
}

function getUserRoles(badges) {
    if (!badges) return "";
    if (badges.includes("broadcaster")) return "broadcaster";
    if (badges.includes("moderator")) return "mod";
    if (badges.includes("vip")) return "vip";
    if (badges.includes("subscriber")) return "subscriber";
    return "";
}

// chat ist fixed. Mach dass man mit drag es verschieben kann
const chatContainer = document.getElementById("chat");
let isDragging = false;
let offsetX, offsetY;
chatContainer.addEventListener("mousedown", (e) => {
    isDragging = true;
    offsetX = e.clientX - chatContainer.getBoundingClientRect().left;
    offsetY = e.clientY - chatContainer.getBoundingClientRect().top;
});
chatContainer.addEventListener("mousemove", (e) => {
    if (isDragging) {
        const newLeft = e.clientX - offsetX;
        const newTop = e.clientY - offsetY;

        // Begrenzungen berechnen
        const containerRect = chatContainer.getBoundingClientRect();
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;

        const maxLeft = windowWidth - containerRect.width;
        const maxTop = windowHeight - containerRect.height;

        // Begrenzte Positionen setzen
        chatContainer.style.left = `${Math.min(Math.max(newLeft, 0), maxLeft)}px`;
        chatContainer.style.top = `${Math.min(Math.max(newTop, 0), maxTop)}px`;
    }
});
chatContainer.addEventListener("touchmove", (e) => {
    if (isDragging) {
        const newLeft = e.touches[0].clientX - offsetX;
        const newTop = e.touches[0].clientY - offsetY;

        // Begrenzungen berechnen
        const containerRect = chatContainer.getBoundingClientRect();
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;

        const maxLeft = windowWidth - containerRect.width;
        const maxTop = windowHeight - containerRect.height;

        // Begrenzte Positionen setzen
        chatContainer.style.left = `${Math.min(Math.max(newLeft, 0), maxLeft)}px`;
        chatContainer.style.top = `${Math.min(Math.max(newTop, 0), maxTop)}px`;
    }
});
chatContainer.addEventListener("mouseup", () => {
    isDragging = false;
});
chatContainer.addEventListener("mouseleave", () => {
    isDragging = false;
});
chatContainer.addEventListener("touchstart", (e) => {
    isDragging = true;
    offsetX = e.touches[0].clientX - chatContainer.getBoundingClientRect().left;
    offsetY = e.touches[0].clientY - chatContainer.getBoundingClientRect().top;
});

chatContainer.addEventListener("touchend", () => {
    isDragging = false;
});
chatContainer.addEventListener("touchcancel", () => {
    isDragging = false;
});
